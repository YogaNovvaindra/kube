# Harbor Helm Chart Values
# Reference: https://github.com/goharbor/harbor-helm/blob/master/values.yaml

expose:
  type: ingress
  tls:
    enabled: true
    certSource: "none"
  ingress:
    hosts:
      core: reg.ygnv.my.id
    annotations:
      kubernetes.io/ingress.class: traefik

externalURL: https://reg.ygnv.my.id

# Using your existing Postgres - all credentials from harbor-cred secret
database:
  type: external
  external:
    host: "postgres"
    port: "5432"
    username: "dummy" # Overridden by extraEnvVars
    password: "dummy" # Overridden by extraEnvVars
    coreDatabase: "registry"
    existingSecret: "" # We handle this via extraEnvVars for more control

# Using your existing Redis (Valkey)
redis:
  type: external
  external:
    addr: "valkey:6379"
    coreDatabaseIndex: "0"
    jobserviceDatabaseIndex: "1"
    registryDatabaseIndex: "2"
    trivyAdapterIndex: "5"

persistence:
  enabled: true
  resourcePolicy: "keep"
  persistentVolumeClaim:
    registry:
      existingClaim: "harbor-registry-pvc"
    jobservice:
      jobLog:
        existingClaim: "harbor-jobservice-pvc"
    trivy:
      existingClaim: "harbor-trivy-pvc"

# ============================================
# SECRET MAPPINGS - Using harbor-cred
# ============================================

# Admin Password
existingSecretAdminPassword: "harbor-cred"
existingSecretAdminPasswordKey: "HARBOR_ADMIN_PASSWORD"
harborAdminPassword: ""

# Secret Key (16 chars) - Used for encryption
secretKey: "not-a-secure-key" # Default, will be overridden
existingSecretSecretKey: "harbor-cred"

# Core Component Configuration
core:
  # Core secret - needs harbor-core secret with key 'secret'
  existingSecret: "harbor-core"

  # XSRF/CSRF protection key
  xsrfKey: "" # Will use existing secret
  existingXsrfSecret: "harbor-cred"
  existingXsrfSecretKey: "CORE_KEY"

  # Extra environment variables for database access
  extraEnvVars:
    - name: POSTGRESQL_PASSWORD
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_PASSWORD"
    - name: POSTGRESQL_USERNAME
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_USER"
    - name: POSTGRESQL_DATABASE
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_DB"
    - name: REGISTRY_CREDENTIAL_PASSWORD
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "REGISTRY_CREDENTIAL_PASSWORD"

# Jobservice Component Configuration
jobservice:
  secret: "" # Will use existing secret
  existingSecret: "harbor-cred"
  existingSecretKey: "JOBSERVICE_SECRET"

  extraEnvVars:
    - name: POSTGRESQL_PASSWORD
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_PASSWORD"
    - name: POSTGRESQL_USERNAME
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_USER"
    - name: POSTGRESQL_DATABASE
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_DB"
    - name: REGISTRY_CREDENTIAL_PASSWORD
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "REGISTRY_CREDENTIAL_PASSWORD"

# Registry Component Configuration
registry:
  secret: "" # Will use existing secret
  existingSecret: "harbor-cred"
  existingSecretKey: "REGISTRY_HTTP_SECRET"

  credentials:
    username: "harbor_registry_user"
    password: "harbor_registry_password"
    existingSecret: "harbor-cred"
    # Note: Harbor expects keys REGISTRY_PASSWD and REGISTRY_HTPASSWD
    # But based on deployment, it uses REGISTRY_CREDENTIAL_PASSWORD

  registry:
    extraEnvVars:
      - name: POSTGRESQL_PASSWORD
        valueFrom:
          secretKeyRef:
            name: "harbor-cred"
            key: "POSTGRES_PASSWORD"
      - name: POSTGRESQL_USERNAME
        valueFrom:
          secretKeyRef:
            name: "harbor-cred"
            key: "POSTGRES_USER"
      - name: POSTGRESQL_DATABASE
        valueFrom:
          secretKeyRef:
            name: "harbor-cred"
            key: "POSTGRES_DB"

  controller:
    extraEnvVars:
      - name: POSTGRESQL_PASSWORD
        valueFrom:
          secretKeyRef:
            name: "harbor-cred"
            key: "POSTGRES_PASSWORD"
      - name: POSTGRESQL_USERNAME
        valueFrom:
          secretKeyRef:
            name: "harbor-cred"
            key: "POSTGRES_USER"
      - name: POSTGRESQL_DATABASE
        valueFrom:
          secretKeyRef:
            name: "harbor-cred"
            key: "POSTGRES_DB"

# Trivy Scanner Configuration
trivy:
  enabled: true
  extraEnvVars:
    - name: POSTGRESQL_PASSWORD
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_PASSWORD"
    - name: POSTGRESQL_USERNAME
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_USER"
    - name: POSTGRESQL_DATABASE
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_DB"

# Exporter Configuration
exporter:
  extraEnvVars:
    - name: POSTGRESQL_PASSWORD
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_PASSWORD"
    - name: POSTGRESQL_USERNAME
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_USER"
    - name: POSTGRESQL_DATABASE
      valueFrom:
        secretKeyRef:
          name: "harbor-cred"
          key: "POSTGRES_DB"

# Portal Configuration
portal:
  extraEnvVars: []

# Nginx Configuration
nginx:
  extraEnvVars: []

# Disable metrics
metrics:
  enabled: true

# Log level
logLevel: info

# Image pull policy
imagePullPolicy: IfNotPresent
