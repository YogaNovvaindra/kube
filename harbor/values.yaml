# Harbor Helm Chart Values
# Reference: https://github.com/goharbor/harbor-helm/blob/master/values.yaml

expose:
  type: clusterIP
  tls:
    enabled: false

externalURL: https://reg.ygnv.my.id

# Using your existing Postgres - all credentials from harbor-cred secret
database:
  type: external
  external:
    host: "postgres"
    port: "5432"
    username: "postgres" # Or your actual DB user
    coreDatabase: "registry"
    existingSecret:
      "harbor-cred" # This will look for the 'password' key by default.
      # Wait, your secret key is POSTGRESQL_PASSWORD.
      # I should keep it as extraEnvVars to avoid another kubeseal run.

# Using your existing Redis (Valkey)
redis:
  type: external
  external:
    addr: "valkey:6379"
    coreDatabaseIndex: "0"
    jobserviceDatabaseIndex: "2"
    registryDatabaseIndex: "1"
    trivyAdapterIndex: "5"

persistence:
  enabled: true
  resourcePolicy: "keep"
  persistentVolumeClaim:
    registry:
      existingClaim: "harbor-registry-pvc"
    jobservice:
      jobLog:
        existingClaim: "harbor-jobservice-pvc"
    trivy:
      existingClaim: "harbor-trivy-pvc"

# ============================================
# SECRET MAPPINGS - Using harbor-cred
# ============================================

# Admin Password
existingSecretAdminPassword: "harbor-cred"
existingSecretAdminPasswordKey: "HARBOR_ADMIN_PASSWORD"
harborAdminPassword: ""

# Secret Key (16 chars) - Used for encryption
secretKey: "not-a-secure-key" # Default, will be overridden
existingSecretSecretKey: "harbor-cred"

# Core Component Configuration
core:
  nodeSelector:
    kubernetes.io/arch: amd64
  # Core secret - needs harbor-cred secret with key 'secret'
  existingSecret: "harbor-cred"
  resources:
    requests:
      memory: 64Mi

  # TLS certificate and private key for token encryption/decryption.
  secretName: "harbor-token-cred"

  # XSRF/CSRF protection key
  xsrfKey: "" # Will use existing secret
  existingXsrfSecret: "harbor-cred"
  existingXsrfSecretKey: "CORE_KEY"

# Jobservice Component Configuration
jobservice:
  nodeSelector:
    kubernetes.io/arch: amd64
  secret: "" # Will use existing secret
  existingSecret: "harbor-cred"
  existingSecretKey: "JOBSERVICE_SECRET"
  resources:
    requests:
      memory: 64Mi

# Registry Component Configuration
registry:
  nodeSelector:
    kubernetes.io/arch: amd64
  secret: "" # Will use existing secret
  existingSecret: "harbor-cred"
  existingSecretKey: "REGISTRY_HTTP_SECRET"
  resources:
    requests:
      memory: 64Mi

  credentials:
    username: "harbor"
    existingSecret: "harbor-cred"

# Trivy Scanner Configuration
trivy:
  nodeSelector:
    kubernetes.io/arch: amd64
  enabled: true
  resources:
    requests:
      memory: 256Mi

# Exporter Configuration
exporter:
  nodeSelector:
    kubernetes.io/arch: amd64
  resources:
    requests:
      memory: 32Mi

# Portal Configuration
portal:
  nodeSelector:
    kubernetes.io/arch: amd64
  resources:
    requests:
      memory: 32Mi
  extraEnvVars: []

# Nginx Configuration
nginx:
  nodeSelector:
    kubernetes.io/arch: amd64
  resources:
    requests:
      memory: 32Mi
  extraEnvVars: []

# Disable metrics
metrics:
  enabled: true

# Log level
logLevel: info

# Image pull policy
imagePullPolicy: IfNotPresent
