apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: argocd

resources:
  # Official Argo CD installation manifest - stable release
  - https://raw.githubusercontent.com/argoproj/argo-cd/v3.2.2/manifests/install.yaml
  # Custom Traefik IngressRoute
  - ingress.yml
  - argocd-notifications-secret.yml

patches:
  # Apply custom configurations to ConfigMaps
  - path: patches/configmap-cmd-params.yml
  - path: patches/configmap-cm.yml
  - path: patches/configmap-rbac.yml
  - path: patches/secret-ownership.yml
  - path: patches/configmap-notifications.yml
    target:
      kind: ConfigMap
      name: argocd-notifications-cm
  # Set imagePullPolicy to IfNotPresent for all deployments
  - path: patches/image-pull-policy.yml
  # Set resource requests for all containers
  - path: patches/resources.yml

images:
  # Replace all Argo CD images with custom registry
  # Renovate will automatically update these tags
  - name: quay.io/argoproj/argocd
    newName: reg.ygnv.my.id/quay/argoproj/argocd
  # Replace Dex image
  - name: ghcr.io/dexidp/dex
    newName: reg.ygnv.my.id/ghcr/dexidp/dex
  # Replace Redis image
  - name: public.ecr.aws/docker/library/redis
    newName: reg.ygnv.my.id/docker/redis
